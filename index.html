<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV to JSON Converter</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h2 class="mb-4">CSV to JSON Converter</h2>
        <input type="file" id="csvFileInput" accept=".csv" class="form-control mb-3">
        <button id="parseButton" class="btn btn-primary mb-3">Parse CSV</button>
        <div id="languageMapping" class="mt-4"></div>
        <button id="generateJsonButton" class="btn btn-success mt-3">Generate JSON</button>
        <pre id="jsonOutput" class="mt-4"></pre>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        const languageCodeMapping = {
            "ar": "Arabic",
            "zh-Hans": "Simplified Chinese",
            "fr": "French",
            "de": "German",
            "el": "Greek",
            "he": "Hebrew",
            "it": "Italian",
            "ja": "Japanese",
            "ko": "Korean",
            "nl": "Dutch",
            "pl": "Polish",
            "pt-PT": "Portuguese (Portugal)",
            "pt-BR": "Portuguese (Brazil)",
            "ru": "Russian",
            "sv": "Swedish",
            "es": "Spanish",
            "th": "Thai",
            "vi": "Vietnamese"
        };

        document.getElementById('parseButton').addEventListener('click', () => {
            const fileInput = document.getElementById('csvFileInput');
            if (fileInput.files.length === 0) {
                alert('Please select a CSV file to parse.');
                return;
            }
            const file = fileInput.files[0];
            Papa.parse(file, {
                header: true,
                complete: function(results) {
                    processCsv(results.data);
                }
            });
        });

        function processCsv(data) {
            const languageMappingDiv = document.getElementById('languageMapping');
            languageMappingDiv.innerHTML = '';

            const languages = Object.keys(data[0]).filter(key => key !== 'en');
            languages.forEach(language => {
                const label = document.createElement('label');
                label.textContent = `Map CSV language code "${language}" to:`;
                label.classList.add('form-label', 'mt-3');

                const select = document.createElement('select');
                select.classList.add('form-select', 'mb-3');

                Object.entries(languageCodeMapping).forEach(([code, name]) => {
                    const option = document.createElement('option');
                    option.value = code;
                    option.textContent = `${name} (${code})`;
                    if (code === language) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });

                const customOption = document.createElement('option');
                customOption.value = 'custom';
                customOption.textContent = 'Add New Language Code';
                select.appendChild(customOption);

                select.addEventListener('change', () => {
                    if (select.value === 'custom') {
                        const newCode = prompt('Enter new language code:');
                        if (newCode) {
                            const newOption = document.createElement('option');
                            newOption.value = newCode;
                            newOption.textContent = `Custom (${newCode})`;
                            select.insertBefore(newOption, customOption);
                            newOption.selected = true;
                        }
                    }
                });

                languageMappingDiv.appendChild(label);
                languageMappingDiv.appendChild(select);
            });
        }

        document.getElementById('generateJsonButton').addEventListener('click', () => {
            const fileInput = document.getElementById('csvFileInput');
            if (fileInput.files.length === 0) {
                alert('Please select a CSV file to parse.');
                return;
            }
            const file = fileInput.files[0];
            Papa.parse(file, {
                header: true,
                complete: function(results) {
                    const json = generateJson(results.data);
                    document.getElementById('jsonOutput').textContent = JSON.stringify(json, null, 2);
                }
            });
        });

        function generateJson(data) {
            const json = {
                client_identifier: "1fae0f32-f740-47b3-ad98-eaf190a98b9f",
                en: {}
            };

            data.forEach(row => {
                const term = row['en'];
                const translations = [];
                const kind = guessKind(term);

                Object.keys(row).forEach(langCode => {
                    if (langCode !== 'en' && row[langCode]) {
                        translations.push({ [langCode]: row[langCode] });
                    }
                });

                json.en[term] = {
                    description: null,
                    kind: kind,
                    translations: translations
                };
            });

            return json;
        }

        function guessKind(term) {
            // Apply the rules provided: if term is always the same, it's a "name"
            return term.match(/^[A-Z]/) ? "name" : "general";
        }
    </script>
</body>
</html>
